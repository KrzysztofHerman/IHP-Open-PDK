// Converted from IHP SG13G2 PDK for Ngspice

//******************************************************************************* 
//*                                                                             * 
//* Copyright 2023 IHP PDK Authors                                              *
//*                                                                             *
//* Licensed under the Apache License, Version 2.0 (the "License");             *
//* you may not use this file except in compliance with the License.            *
//* You may obtain a copy of the License at                                     *
//*                                                                             *
//*     https://www.apache.org/licenses/LICENSE-2.0                             *
//*                                                                             *
//* Unless required by applicable law or agreed to in writing, software         *
//* distributed under the License is distributed on an "AS IS" BASIS,           *
//* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.    *
//* See the License for the specific language governing permissions and         *
//* limitations under the License.                                              *
//*                                                                             *
//******************************************************************************* 

//*******************************************************************************
//* parasitics 
//*******************************************************************************

//* SiO2: only area cap., prozess tol. cap_cpara
//* C value is taken from extraction routine

subckt cparasitic(plus minus)
parameters c=0
parameters w=0
parameters l=0
parameters ic=1e10
parameters tc1=0
parameters tc2=0
@if (ic>1e9)
  c1 (plus minus) sg13g2_default_mod_c  c=c*cap_cpara tc1=tc1 tc2=tc2
@else
  c1 (plus minus) sg13g2_default_mod_c  c=c*cap_cpara tc1=tc1 tc2=tc2
@end
ends


//*******************************************************************************
//* cmim 
//*******************************************************************************

model cmim_core sp_capacitor ( 
  tc1=3.6e-6 tc2=2e-9 tnom=27 cj=cap_carea cjsw=40e-18
)

//* subcircuit for cmim
//* Note: top/bottom plate parasitic capacitance is included by parasiticC extraction!
//* Note: top (Metal3) corresponds to PLUS pin
//*
subckt cap_cmim(plus minus)
parameters l=7u
parameters w=7u
parameters mm_ok=0
parameters sf=1e-6
parameters ic=1e10
r1 (plus 1) sg13g2_default_mod_r  r=55m
@if (ic>1e9)
  c1 (1 minus) cmim_core  l=l/sf w=w/sf scale=1
@else
  c1 (1 minus) cmim_core  l=l/sf w=w/sf scale=1
@end
ends


//*******************************************************************************
//* rfcmim 
//*******************************************************************************

//* subcircuit for rfcmim
//* Note: top plate (Metal3) corresponds to PLUS pin, bottom plate corresponds to MINUS pin, bn is substrate bulk node
//* Note: valid parameter range for w and l: 7um to 75um
//* Note: valid parameter range for wfeed: 1um to 30um but maximum wfeed = w-1.2um
//*
subckt cap_rfcmim(plus minus bn)
parameters l=7u
parameters w=7u
parameters mm_ok=0
parameters wfeed=2e-6

parameters ic=1e10
parameters sf=1e-6
parameters cic0=1e-18

parameters lplate_val={(0.353158*(l/sf)+0.485684*l/w)*1e-12}
parameters lfeed_val={(6.03468+0.0814268*(w/sf)-0.821243*log(wfeed/sf)/log(1.55))*1e-12}
parameters lskin_val={1.18545e-012+6.95462e-014*(l/sf)}
parameters cox_val={(0.48922+0.0965145*(w+l)/sf+0.00610947*(w*l)/(sf*sf)+0.017*(wfeed/sf)*5)*1e-15}
parameters csub_val={(50.1021+0.277881*(w+l)/sf+1.25023e-005*(w*l)/(sf*sf))*1e-15}
parameters rsub_val={610.132-1.11685*(w+l)/sf+0.00434371*(w*l)/(sf*sf)}
parameters rmim_val={0.0463973+0.00219577*l/w+0.961292/(wfeed/sf)+0.00307712*(l/sf)+0.000217076*(l/sf)*l/w}
parameters rskin_val={0.154618+0.00702016*(l/sf)}

//* add tiny element to allow passing an IC value
@if (ic>1e9)
  cic1 (plus bn) sg13g2_default_mod_c  c=cic0
  cic2 (minus bn) sg13g2_default_mod_c  c=cic0
@else
  cic1 (plus bn) sg13g2_default_mod_c  c=cic0
  cic2 (minus bn) sg13g2_default_mod_c  c=cic0
@end

//* --------- model subcircuit ------------------------------
lskin (plus 2) sg13g2_default_mod_l  l=lskin_val
rskin (plus 2) sg13g2_default_mod_r  r=rskin_val

@if ((lplate_val+lfeed_val-lskin_val)>1e-18)
  lmim (2 3) sg13g2_default_mod_l  l=(lplate_val+lfeed_val-lskin_val)
@else
  lmim (2 3) sg13g2_default_mod_l  l=1e-18
@end

rmim (3 4) sg13g2_default_mod_r  r=rmim_val
cmim (4 5) cmim_core  l=l/sf w=w/sf scale=1
cox (5 51) sg13g2_default_mod_c  c=cox_val
csub (51 bn) sg13g2_default_mod_c  c=csub_val

@if (rsub_val>10m)
  rsub (51 bn) sg13g2_default_mod_r  r=rsub_val
@else
  rsub (51 bn) sg13g2_default_mod_r  r=10m
@end

@if (lfeed_val>1e-18)
  lfeed (5 minus) sg13g2_default_mod_l  l=lfeed_val
@else
  lfeed (5 minus) sg13g2_default_mod_l  l=1e-18
@end

//*avoid floating node for initial condition
rdummy (5 bn) sg13g2_default_mod_r  r=1G

ends
