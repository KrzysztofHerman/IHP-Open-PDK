// Converted from IHP SG13G2 PDK for Ngspice

//******************************************************************************* 
//*                                                                             * 
//* Copyright 2025 IHP PDK Authors                                              *
//*                                                                             *
//* Licensed under the Apache License, Version 2.0 (the "License");             *
//* you may not use this file except in compliance with the License.            *
//* You may obtain a copy of the License at                                     *
//*                                                                             *
//*     https://www.apache.org/licenses/LICENSE-2.0                             *
//*                                                                             *
//* Unless required by applicable law or agreed to in writing, software         *
//* distributed under the License is distributed on an "AS IS" BASIS,           *
//* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.    *
//* See the License for the specific language governing permissions and         *
//* limitations under the License.                                              *
//*                                                                             *
//******************************************************************************* 
//*******************************************************************************
//* MOS SVaricap section
//*******************************************************************************
//*
//*                        Gate1
//*                        |  Well
//*                        |  |  Gate2
//*                        |  |  |  Substrate
//*                        |  |  |  |
subckt sg13_hv_svaricap(g1 w g2 bn)
parameters l=600e-9 w=3e-6 mm_ok=1 nx=1 ny=1 trise=0 ic_=1e10

//*LowL  paramtest warnif = (l<300n)  message="Channel length must be >=300n."
//*HiL  paramtest warnif = (l>800n)  message="Channel length must be <=800n."
//*LowW  paramtest warnif = (w<3.74um)  message="Channel width must be >=3.74u"
//*HiW  paramtest warnif = (w>9.74um)  message="Channel width must be <=9.74u"
//*LowNX  paramtest warnif = (Nx<1)  message="NX must be >=1."
//*HiNX  paramtest warnif = (Nx>10)  message="NX must be <=10."
//*LowNY  paramtest warnif = (Ny<1)  message="NYmust be >=1."
//*HiNY  paramtest warnif = (Ny>1)  message="NY must be <=1."
//*
//*internal parameters, do not pass from outside
parameters rwell0=32.85
parameters rwellw=-2.499e+06
parameters rwellnx=4.759e+06
parameters rwellvw=0
parameters rwellwvw=0
parameters rwellnxvw=0
parameters rsubw0=0.2596
parameters rsubwf=0.0009212
parameters rsubwexp=0.6952
parameters ck0=4.267e-16
parameters ckwnx=-7.948e-11
parameters ckw=1.252e-10
parameters cic0=1e-18
parameters vfbo=-0.04009
parameters toxo=6.945e-09
parameters rk0=346.7
parameters rkwnx=0.000631

//*
//* add tiny element to allow passing an IC value
@if (ic_>1e9)
   cic1 (g1 w0) sg13g2_default_mod_c  c=cic0
   cic2 (g2 w0) sg13g2_default_mod_c  c=cic0
@else
   cic1 (g1 w0) sg13g2_default_mod_c  c=cic0
   cic2 (g2 w0) sg13g2_default_mod_c  c=cic0
@end

//*-- dummy nodes
rdummy1 (w 2) sg13g2_default_mod_r  r=0.0001
rdummy2 (bn 4) sg13g2_default_mod_r  r=0.0001

//* --------- MOS Varactor 1 ------------------------------
nmvcap1 (g1 bi1 w0) sg13_hv_svaricap  l=l w=w $mfactor=nx*ny dta=trise

//* --------- MOS Varactor 2 ------------------------------
nmvcap2 (g2 bi2 w0) sg13_hv_svaricap  l=l w=w $mfactor=nx*ny dta=trise

//* --------- Well Parasitic --------------------
rww (w w0) sg13g2_default_mod_r (
  
  r=((((rwell0+(rwellvw*(v(2,4))))+((rwellw+(rwellwvw*(v(2,4))))*w))+(((rwellnx+(rwellnxvw*(v(2,4))))*w)/(nx*ny)))*nx)*ny
)
dsubw (w1 w) dsubw (
  area=(((nx*0.38u)+(nx*l))+1.11u)*(ny*(w+0.97u))
  pj=2*((((nx*0.38u)+(nx*l))+1.11u)+(ny*(w+0.97u)))
)
rsubw (w1 bn) sg13g2_default_mod_r (
  r=(rsubw0/(sqrt(pow(nx,rsubwexp))))/(w+rsubwf)
)
model dsubw sp_diode ( 
  is=2.45e-17 jsw=5.959e-10 n=4 ns=1.029 cjo=1.444e-15 vj=0.1 m=0.1052
  cjp=1.117e-09 php=0.457 mjsw=0.2595 fc=0.95 cta=1e-06
)

//* --------- Coupling G1 G2 capacitance with serial resistor ---------
ck_g12 (g1 g2a) sg13g2_default_mod_c (
  c=(((ck0+(ckw*w))+((ckwnx*w)/(nx*ny)))*nx)*ny
)
rk (g2a g2) sg13g2_default_mod_r  r=(rk0+(rkwnx/w))/(nx*ny)

model sg13_hv_svaricap mosvar ( 
  version=1.3 subversion=0 revision=0 level=1000 tmin=-100 tmax=500 vmax=1e+04
  tr=27 lmin=2.99e-07 lmax=8.1e-07 wmin=3.7e-06 wmax=9.8e-06 swres=1 swigate=1
  type=-1 typep=-1 toxo=toxo*sg13g2_hv_svaricap_toxo tau=0.1
  vfbo=vfbo*sg13g2_hv_svaricap_vfbo nsubo=3.802e+23 mnsubo=1 dnsubo=0 vnsubo=0
  nslpo=0.1 npo=1e+27 qmc=1 dlq=4.31e-10*sg13g2_hv_svaricap_dlq
  dwq=-1.081e-07*sg13g2_hv_svaricap_dwq dwr=0 cfrl=1.856e-09 cfrw=3.155e-11
  rshg=0 rpv=0 rend=0.0003795 rshs=727.8 uac=0.06 uacred=0 stvfb=0 strshg=0
  strpv=0 strend=0 strshs=0 stuac=40 feta=1 chibo=3.1 chibpo=4.5 stig=2 lov=0
  novo=1.311e+25 iginvlw=0 igovw=0 gcoo=0 gc2o=0.375 gc3o=0.063 igchvlw=0
  igovhvw=0 gcohvo=0 gc2hvo=0.375 gc3hvo=0.063 igmax=1e-02
)

ends
